PROGNAME=opc

CC= gcc
CFLAGS= -std=gnu99 -O0 -g -Wall -Wextra -Wstrict-prototypes $(SYSCFLAGS) $(MYCFLAGS)
LDFLAGS= $(SYSLDFLAGS) $(MYLDFLAGS)
LIBS= -lm $(SYSLIBS) $(MYLIBS)

AR= ar rcu
RANLIB= ranlib
RM= rm -f
UNAME= uname

SYSCFLAGS=
SYSLDFLAGS=
SYSLIBS=

OPCOBJ:=cmdoptions.o util.o vector.o union.o postprocess.o point.o technology.o transformationmatrix.o ltransformationmatrix.o shape.o object.o geometry.o keyvaluepairs.o generics.o lgenerics.o lgeometry.o ldir.o lpoint.o graphics.o lbind.o lload.o lobject.o pcell.o lfilesystem.o lplacer.o lplacer_rand.o lplacer_nonoverlapping.o lplacer_classic.o lrouter.o lrouter_net.o lrouter_queue.o lrouter_field.o lrouter_route.o gdsparser.o ldebug.o export.o export_common.o gdsexport.o info.o

.PHONY: default
default:
	@echo Guessing `$(UNAME)`
	@$(MAKE) `$(UNAME)`

$(PROGNAME): main.c lua/liblua.a $(OPCOBJ)
	$(CC) $(CFLAGS) -DLUA_COMPAT_5_3 -DLUA_USE_LINUX -o $(PROGNAME) main.c $(OPCOBJ) lua/liblua.a -lm -ldl

lua/liblua.a: lua/*.c lua/*.h
	@$(MAKE) -C lua liblua.a

.PHONY: clean
clean:
	rm -f $(PROGNAME) config.h
	rm -f $(OPCOBJ)
	rm -f lua/*.o lua/liblua.a

AIX aix:
	@$(MAKE) $(ALL) CC="xlc" CFLAGS="-O2 -DLUA_USE_POSIX -DLUA_USE_DLOPEN" SYSLIBS="-ldl" SYSLDFLAGS="-brtl -bexpall"

bsd:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_POSIX -DLUA_USE_DLOPEN" SYSLIBS="-Wl,-E"

c89:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_C89" CC="gcc -std=c89"
	@echo ''
	@echo '*** C89 does not guarantee 64-bit integers for Lua.'
	@echo ''

FreeBSD NetBSD OpenBSD freebsd:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_LINUX -DLUA_USE_READLINE -I/usr/include/edit" SYSLIBS="-Wl,-E -ledit" CC="cc"

generic: $(ALL)

Linux linux:	linux-noreadline

linux-noreadline:
	@$(MAKE) $(PROGNAME) SYSCFLAGS="-DLUA_USE_LINUX" SYSLIBS="-Wl,-E -ldl"

Darwin macos macosx:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_MACOSX -DLUA_USE_READLINE" SYSLIBS="-lreadline"

mingw:
	@$(MAKE) "LUA_A=lua54.dll" "LUA_T=lua.exe" \
	"AR=$(CC) -shared -o" "RANLIB=strip --strip-unneeded" \
	"SYSCFLAGS=-DLUA_BUILD_AS_DLL" "SYSLIBS=" "SYSLDFLAGS=-s" lua.exe
	@$(MAKE) "LUAC_T=luac.exe" luac.exe

posix:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_POSIX"

SunOS solaris:
	@$(MAKE) $(ALL) SYSCFLAGS="-DLUA_USE_POSIX -DLUA_USE_DLOPEN -D_REENTRANT" SYSLIBS="-ldl"

ifndef VERBOSE
.SILENT:
endif

# generated by gcc -MM *.c
cmdoptions.o: cmdoptions.c cmdoptions.h vector.h util.h lua/lua.h \
 lua/luaconf.h
export_common.o: export_common.c export_common.h generics.h \
 keyvaluepairs.h vector.h point.h transformationmatrix.h
gdsexport.o: gdsexport.c gdsexport.h export_common.h generics.h \
 keyvaluepairs.h vector.h point.h transformationmatrix.h
gdsparser.o: gdsparser.c gdsparser.h lua/lua.h lua/luaconf.h \
 lua/lauxlib.h lua/lua.h
generics.o: generics.c generics.h keyvaluepairs.h vector.h technology.h \
 lua/lua.h lua/luaconf.h util.h
geometry.o: geometry.c geometry.h technology.h lua/lua.h lua/luaconf.h \
 vector.h generics.h keyvaluepairs.h object.h transformationmatrix.h \
 point.h shape.h
graphics.o: graphics.c graphics.h lua/lua.h lua/luaconf.h lua/lauxlib.h \
 lua/lua.h lpoint.h point.h
info.o: info.c info.h object.h transformationmatrix.h point.h shape.h \
 generics.h keyvaluepairs.h vector.h
keyvaluepairs.o: keyvaluepairs.c keyvaluepairs.h vector.h
lbind.o: lbind.c lua/lua.h lua/luaconf.h lua/lauxlib.h lua/lua.h
ldebug.o: ldebug.c ldebug.h lua/lua.h lua/luaconf.h
ldir.o: ldir.c ldir.h lua/lua.h lua/luaconf.h lua/lauxlib.h lua/lua.h
lfilesystem.o: lfilesystem.c lfilesystem.h lua/lua.h lua/luaconf.h \
 lua/lauxlib.h lua/lua.h
lgenerics.o: lgenerics.c lgenerics.h lua/lua.h lua/luaconf.h generics.h \
 keyvaluepairs.h vector.h lua/lauxlib.h lua/lua.h technology.h
lgeometry.o: lgeometry.c lgeometry.h lua/lua.h lua/luaconf.h \
 lua/lauxlib.h lua/lua.h geometry.h technology.h vector.h generics.h \
 keyvaluepairs.h object.h transformationmatrix.h point.h shape.h \
 lobject.h lpoint.h
lload.o: lload.c lload.h lua/lua.h lua/luaconf.h config.h lua/lauxlib.h \
 lua/lua.h
lobject.o: lobject.c lobject.h lua/lua.h lua/luaconf.h object.h \
 transformationmatrix.h point.h shape.h generics.h keyvaluepairs.h \
 vector.h lua/lauxlib.h lua/lua.h lpoint.h
lplacer.o: lplacer.c lua/lua.h lua/luaconf.h lua/lauxlib.h lua/lua.h \
 lplacer_nonoverlapping.h lplacer_classic.h
lplacer_classic.o: lplacer_classic.c lplacer_classic.h lua/lua.h \
 lua/luaconf.h lplacer_common.h lplacer_rand.h keyvaluepairs.h vector.h \
 util.h
lplacer_common.o: lplacer_common.c
lplacer_nonoverlapping.o: lplacer_nonoverlapping.c \
 lplacer_nonoverlapping.h lua/lua.h lua/luaconf.h lplacer_rand.h
lplacer_rand.o: lplacer_rand.c lplacer_rand.h lua/lua.h lua/luaconf.h
lpoint.o: lpoint.c lpoint.h lua/lua.h lua/luaconf.h point.h lua/lauxlib.h \
 lua/lua.h
lrouter.o: lrouter.c lua/lua.h lua/luaconf.h lua/lauxlib.h lua/lua.h \
 lrouter_net.h lrouter_queue.h lrouter_route.h lrouter_field.h
lrouter_field.o: lrouter_field.c lrouter_field.h
lrouter_net.o: lrouter_net.c lrouter_net.h lrouter_queue.h \
 lrouter_field.h
lrouter_queue.o: lrouter_queue.c lrouter_queue.h
lrouter_route.o: lrouter_route.c lrouter_net.h lrouter_queue.h \
 lrouter_field.h lrouter_route.h
ltransformationmatrix.o: ltransformationmatrix.c ltransformationmatrix.h \
 lua/lua.h lua/luaconf.h transformationmatrix.h point.h lpoint.h \
 lua/lauxlib.h lua/lua.h
main.o: main.c lua/lprefix.h lua/lua.h lua/luaconf.h lua/lauxlib.h \
 lua/lua.h lua/lualib.h cmdoptions.h vector.h lpoint.h point.h \
 lgeometry.h lgenerics.h generics.h keyvaluepairs.h technology.h \
 ltransformationmatrix.h transformationmatrix.h graphics.h lload.h \
 lbind.h ldir.h lobject.h object.h shape.h pcell.h info.h export.h \
 postprocess.h lfilesystem.h lplacer.h lrouter.h util.h \
 gdsparser.h geometry.h config.h cmdoptions_def.c
object.o: object.c object.h transformationmatrix.h point.h shape.h \
 generics.h keyvaluepairs.h vector.h util.h lua/lua.h lua/luaconf.h \
 pcell.h
pcell.o: pcell.c pcell.h lua/lua.h lua/luaconf.h object.h \
 transformationmatrix.h point.h shape.h generics.h keyvaluepairs.h \
 vector.h lua/lauxlib.h lua/lua.h util.h lobject.h
point.o: point.c point.h
postprocess.o: postprocess.c postprocess.h object.h \
 transformationmatrix.h point.h shape.h generics.h keyvaluepairs.h \
 vector.h union.h pcell.h lua/lua.h lua/luaconf.h
shape.o: shape.c shape.h point.h transformationmatrix.h generics.h \
 keyvaluepairs.h vector.h geometry.h technology.h lua/lua.h lua/luaconf.h \
 object.h
technology.o: technology.c technology.h lua/lua.h lua/luaconf.h vector.h \
 generics.h keyvaluepairs.h lua/lauxlib.h lua/lua.h util.h
transformationmatrix.o: transformationmatrix.c transformationmatrix.h \
 point.h
union.o: union.c union.h vector.h point.h shape.h transformationmatrix.h \
 generics.h keyvaluepairs.h
util.o: util.c util.h lua/lua.h lua/luaconf.h lua/lauxlib.h lua/lua.h \
 lua/lualib.h
vector.o: vector.c vector.h
